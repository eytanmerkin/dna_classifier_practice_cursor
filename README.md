# DNA Sequence Classifier

A machine learning pipeline for classifying DNA sequences by gene type using k-mer feature extraction and traditional ML models (Random Forest, XGBoost).

## Disclaimer
⚠️ This entire project was generated by Cursor AI as an exercise to explore AI coding agent capabilities. The content is provided for educational and demonstration purposes only. The author takes no responsibility for any inaccuracies, errors, or issues that may arise from using this code or relying on the information presented.

## Project Overview

This project classifies DNA nucleotide sequences by gene type using k-mer feature extraction and traditional ML models.

### Version 2.0 (Current)

**5 Classes** (grouped for better performance):
- **PSEUDO** - Pseudogenes (non-functional gene copies)
- **BIOLOGICAL_REGION** - Regulatory regions (enhancers, promoters)
- **NON_CODING_RNA** - All non-coding RNA types (ncRNA, snoRNA, snRNA, scRNA, tRNA, rRNA)
- **PROTEIN_CODING** - Protein-coding genes
- **OTHER** - Other gene types

### Version 1.0 (Legacy)

**10 Classes** (original structure):
- Individual RNA types: ncRNA, snoRNA, snRNA, scRNA, tRNA, rRNA
- Plus: PSEUDO, BIOLOGICAL_REGION, PROTEIN_CODING, OTHER

## Results Summary

### Version 2.0 (Recommended)

| Metric | Validation | Test | Improvement vs v1 |
|--------|------------|------|-------------------|
| Accuracy | 90.08% | **86.57%** | +3.6% |
| Macro F1 | 85.08% | **76.06%** | +23.3% |
| Weighted F1 | - | **86.66%** | +4.1% |

**Best Model**: XGBoost (n_estimators=200, max_depth=10)

### Per-Class Performance (v2 Test Set)

| Class | Precision | Recall | F1-Score | Support |
|-------|-----------|--------|----------|---------|
| BIOLOGICAL_REGION | 0.94 | 0.89 | **0.92** | 1,405 |
| PSEUDO | 0.88 | 0.88 | **0.88** | 2,118 |
| NON_CODING_RNA | 0.77 | 0.85 | **0.81** | 870 |
| OTHER | 0.82 | 0.61 | **0.70** | 66 |
| PROTEIN_CODING | 0.49 | 0.51 | **0.50** | 105 |

**Key Improvement**: NON_CODING_RNA achieves 0.81 F1 (vs 0.00-0.67 for individual RNA types in v1)

### Version 1.0 (Legacy)

| Metric | Test |
|--------|------|
| Accuracy | 83.55% |
| Macro F1 | 61.68% |

## Project Structure

```
dna_classifier/
├── DNA_seq_pred/              # Original data (v1)
├── DNA_seq_pred_cleaned/      # v1 cleaned data
├── DNA_seq_pred_v2/           # Merged dataset (v2)
├── DNA_seq_pred_cleaned_v2/   # v2 cleaned data (with class grouping)
├── DNA_seq_pred_additional/   # Additional NCBI data (when collected)
├── analysis_output/           # Reports and visualizations
│   ├── plots/
│   ├── v2_final_report.md     # Comprehensive v2 report
│   ├── model_comparison_v1_v2.md
│   └── ...
├── models/                    # Saved trained models
│   ├── best_model.joblib      # v1 model
│   └── best_model_v2.joblib   # v2 model (recommended)
├── scripts/                   # Data collection scripts
│   ├── explore_ncbi_data.py
│   ├── fetch_ncbi_data.py
│   ├── validate_new_data.py
│   ├── merge_datasets.py
│   └── compare_models.py
├── src/                       # Source code
│   ├── features.py            # K-mer feature extraction
│   ├── data_loader.py         # Data loading (with class grouping)
│   ├── train.py               # Model training
│   ├── evaluate.py            # Model evaluation
│   └── main.py                # CLI entry point
├── tests/                     # Unit tests
│   ├── test_features.py       # Tests for k-mer extraction
│   └── test_data_loader.py    # Tests for data loading
├── clean_data.py              # v1 data cleaning
├── clean_data_v2.py           # v2 data cleaning (with grouping)
├── analyze_data.py            # v1 analysis
├── analyze_data_v2.py         # v2 analysis
├── conftest.py                # Pytest fixtures
├── requirements.txt           # Python dependencies
└── README.md
```

## Installation

```bash
# Clone the repository
git clone https://github.com/YOUR_USERNAME/dna_classifier.git
cd dna_classifier

# Create virtual environment
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt
```

## Usage

### Train a Model (v2 - Recommended)

```bash
# Train v2 model with grouped classes (recommended)
python src/main.py --train --evaluate --version v2

# Train v2 with hyperparameter tuning
python src/main.py --train --evaluate --version v2 --tune

# Train specific model type
python src/main.py --train --model xgb --version v2
```

### Train Legacy v1 Model

```bash
# Train v1 model (10 classes, original structure)
python src/main.py --train --evaluate --version v1
```

### Evaluate Models

```bash
# Evaluate v2 model (recommended)
python src/main.py --evaluate --version v2

# Evaluate v1 model
python src/main.py --evaluate --version v1

# Compare v1 vs v2
python scripts/compare_models.py
```

### Options

| Flag | Description | Default |
|------|-------------|---------|
| `--train` | Train a model | - |
| `--evaluate` | Evaluate on test set | - |
| `--version` | Version: v1 or v2 | v1 |
| `--model` | Model type: rf, xgb, both | both |
| `--k` | K-mer length | 4 |
| `--tune` | Tune hyperparameters | False |
| `--use-new-data` | Use merged dataset (v2 only) | False |

## Methodology

### Feature Engineering

DNA sequences are converted to numerical features using **k-mer counting**:
1. Slide a window of size k across the sequence
2. Count occurrences of each possible k-mer (4^k possibilities)
3. Normalize by sequence length

For k=4, each sequence becomes a 256-dimensional feature vector.

### Data Preprocessing

The original data had several issues that were fixed:
- **Data Leakage**: 7,204 sequences appeared in both train and test sets → Removed from test
- **Duplicates**: Duplicate sequences → Deduplicated
- **Class Imbalance**: Severe imbalance (PSEUDO: 16k, scRNA: 3) → Addressed via class grouping

### Class Grouping (v2.0)

Version 2.0 groups 6 rare non-coding RNA types into a single `NON_CODING_RNA` class:
- **Before**: ncRNA, snoRNA, snRNA, scRNA, tRNA, rRNA (6 separate classes)
- **After**: NON_CODING_RNA (1 class)
- **Result**: Improved F1 from 0.00-0.67 to 0.81 for these types

### Model Selection

Two models are compared:
1. **Random Forest** with balanced class weights
2. **XGBoost** with multi-class softmax objective

**v2**: XGBoost achieved higher Macro F1 (0.8508 vs 0.8228) and was selected.

## Key Findings

### Version 2.0

1. **Class Grouping Success**: Reducing from 10 to 5 classes improved Macro F1 by 23%
2. **NON_CODING_RNA Performance**: Achieved 0.81 F1 (vs 0.00-0.67 for individual types)
3. **Strong Major Classes**: BIOLOGICAL_REGION (0.92) and PSEUDO (0.88) perform excellently
4. **Areas for Improvement**: PROTEIN_CODING (0.50) and OTHER (0.70) need more data

### Version 1.0

1. **Strong Performance on Major Classes**: BIOLOGICAL_REGION, PSEUDO, and ncRNA achieved F1 > 0.80
2. **Challenges with Rare Classes**: scRNA (1 test sample) and snRNA (6 samples) had very few examples
3. **Feature Importance**: Certain 4-mers are highly predictive

## Data Collection Infrastructure

The project includes scripts for collecting additional data from NCBI:

```bash
# Install biopython
pip install biopython

# Set NCBI email (required)
export NCBI_EMAIL='your.email@example.com'

# Fetch additional sequences
python scripts/fetch_ncbi_data.py

# Validate and merge
python scripts/validate_new_data.py
python scripts/merge_datasets.py
```

See `analysis_output/ncbi_data_sources.md` for detailed documentation.

## Future Improvements

- [x] Class grouping for rare classes ✅ (v2.0)
- [x] Data collection infrastructure ✅ (v2.0)
- [ ] Collect more data for PROTEIN_CODING and OTHER classes
- [ ] Use deep learning (CNN/LSTM) for sequence modeling
- [ ] Add more features (GC content, sequence length, motifs)
- [ ] Hyperparameter tuning for v2 model

## Testing

Run the test suite:

```bash
# Run all tests
pytest tests/ -v

# Run specific test file
pytest tests/test_features.py -v
```

## Dependencies

- pandas >= 1.3.0
- numpy >= 1.21.0
- scikit-learn >= 1.0.0
- xgboost >= 1.5.0
- matplotlib >= 3.4.0
- seaborn >= 0.11.0
- joblib >= 1.1.0
- biopython >= 1.81 (for NCBI data collection)
- pytest >= 7.0.0 (for testing)

## License

MIT License

